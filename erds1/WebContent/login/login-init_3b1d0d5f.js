/*! ablejs - v0.2.0 - Monday, December 15th, 2014, 6:15:46 PM
* http://www.ablesky.com
* Copyright (c) 2014 frontend@ablesky.com; Licensed  */
define("index/login-init",["module","jquery","common/global"],function(e,n,i){n(function(){function o(e){var n="",o="";return r.callbackUrl&&(o="&callbackUrl="+encodeURIComponent(r.callbackUrl)),r.encodedUserInfo&&(n="&encodedUserInfo="+encodeURIComponent(r.encodedUserInfo)),e+=n,e+=o,e+=null==i.queryString("refUrl")?"&refUrl="+encodeURIComponent(document.referrer):"&refUrl="+i.queryString("refUrl")}console.log("JQuery loaded!"),i&&console.log("global module loaded!");var r=e.config(),l=n("#J_loginSection");n("#J_loginMod"),i.queryString("sellSrc");var a=function(e){e&&(n(".warnning-tip .message").html(e).show(),n(".warnning-tip").show())},t=function(){n(".warnning-tip").hide()};document.getElementById("J_loginMod")&&require(["common/module-login"],function(e){if(1==r.isTaobaoCard||1==r.isOneStepLogin||1==r.isAdPlatform){n("#account-register",l).removeAttr("class");var i=0;e.init({isOneStepLogin:!0,isAUIButton:!0,isAdPlatform:!0,loginPanel:"form",isPop:!1,callback:function(){var e=o(PASSPORT_SERVER+"orgUserBindingRedirect.do?action=bindOrgUserToAsAccount&bindWay=login");window.location.href=1==r.isTaobaoCard?"studyCenterRedirect.do?action=loadStudyCenterPage":1==r.isAdPlatform?AD_SERVER+"index.do":e},registerError:function(){i++,a("登陆信息有误，请重新输入！")},registerSuccess:function(){i--,i=0>i?0:i,0==i&&t()},loginError:function(){n(".module-login .field-wrapper").addClass("field-invalid"),a("登录信息有误，请重新输入！")}})}else e.init({focusUsername:!0,loginError:function(){n(".module-login .field-wrapper").addClass("field-invalid")}})}),1==r.isOneStepLogin&&(/shown/.test(window.location.hash)||(r.isLoginLinkExpired?a("跳转链接已过期，请通过登录来跳转目标页"):""===r.encodedUserInfo?a("非常抱歉，由于您所在机构提供的信息有误，所以之前的登录失败，您可以重新登录AbleSky，如您还有其他疑问请联系所在机构！"):a("请和您的AbleSky帐号进行绑定"),window.location.hash=window.location.hash+"login_shown")),require(["account/widget-3partylogin"],function(e){e.init({type:"small",labelText:"您还可以使用其它帐号直接登录",labelIconSpacing:"5",iconSpacing:"4"})})})});